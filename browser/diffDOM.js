var diffDOM=function(e){"use strict";var t,s=!1,n=function(e){var t=this;void 0===e&&(e={}),Object.entries(e).forEach(function(e){var s=e[0],n=e[1];return t[s]=n})};function o(e){var t=[];return"#text"!==e.nodeName&&"#comment"!==e.nodeName&&(t.push(e.nodeName),e.attributes&&(e.attributes.class&&t.push(e.nodeName+"."+e.attributes.class.replace(/ /g,".")),e.attributes.id&&t.push(e.nodeName+"#"+e.attributes.id))),t}function i(e){var t={},s={};return e.forEach(function(e){o(e).forEach(function(e){var n=e in t;n||e in s?n&&(delete t[e],s[e]=!0):t[e]=!0})}),t}function a(e,t){var s=i(e),n=i(t),o={};return Object.keys(s).forEach(function(e){n[e]&&(o[e]=!0)}),o}function l(e){return delete e.outerDone,delete e.innerDone,delete e.valueDone,!e.childNodes||e.childNodes.every(l)}function r(e,t){if(!["nodeName","value","checked","selected","data"].every(function(s){return e[s]===t[s]}))return!1;if(Boolean(e.attributes)!==Boolean(t.attributes))return!1;if(Boolean(e.childNodes)!==Boolean(t.childNodes))return!1;if(e.attributes){var s=Object.keys(e.attributes),n=Object.keys(t.attributes);if(s.length!==n.length)return!1;if(!s.every(function(s){return e.attributes[s]===t.attributes[s]}))return!1}if(e.childNodes){if(e.childNodes.length!==t.childNodes.length)return!1;if(!e.childNodes.every(function(e,s){return r(e,t.childNodes[s])}))return!1}return!0}function c(e,t,s,n,o){if(!e||!t)return!1;if(e.nodeName!==t.nodeName)return!1;if("#text"===e.nodeName)return!!o||e.data===t.data;if(e.nodeName in s)return!0;if(e.attributes&&t.attributes){if(e.attributes.id){if(e.attributes.id!==t.attributes.id)return!1;if(e.nodeName+"#"+e.attributes.id in s)return!0}if(e.attributes.class&&e.attributes.class===t.attributes.class)if(e.nodeName+"."+e.attributes.class.replace(/ /g,".")in s)return!0}if(n)return!0;var i=e.childNodes?e.childNodes.slice().reverse():[],l=t.childNodes?t.childNodes.slice().reverse():[];if(i.length!==l.length)return!1;if(o)return i.every(function(e,t){return e.nodeName===l[t].nodeName});var r=a(i,l);return i.every(function(e,t){return c(e,l[t],r,!0,!0)})}function u(e){return JSON.parse(JSON.stringify(e))}function h(e,t,s,n){var i=0,l=[],r=e.length,u=t.length,h=Array.apply(void 0,new Array(r+1)).map(function(){return[]}),d=a(e,t),f=r===u;f&&e.some(function(e,s){var n=o(e),i=o(t[s]);return n.length!==i.length?(f=!1,!0):(n.some(function(e,t){if(e!==i[t])return f=!1,!0}),!f||void 0)});for(var p=0;p<r;p++)for(var m=e[p],_=0;_<u;_++){var V=t[_];s[p]||n[_]||!c(m,V,d,f)?h[p+1][_+1]=0:(h[p+1][_+1]=h[p][_]?h[p][_]+1:1,h[p+1][_+1]>=i&&(i=h[p+1][_+1],l=[p+1,_+1]))}return 0!==i&&{oldValue:l[0]-i,newValue:l[1]-i,length:i}}function d(e,t){return Array.apply(void 0,new Array(e)).map(function(){return t})}function f(e,t,s){var n=e[t];e[t]=e[s],e[s]=n}n.prototype.toString=function(){return JSON.stringify(this)},n.prototype.setValue=function(e,t){return this[e]=t,this};var p=function(){this.list=[]};p.prototype.add=function(e){var t;(t=this.list).push.apply(t,e)},p.prototype.forEach=function(e){this.list.forEach(function(t){return e(t)})};var m=function(e){var t=this,s=e.debug;void 0===s&&(s=!1);var n=e.diffcap;void 0===n&&(n=10);var o=e.maxDepth;void 0===o&&(o=!1);var i=e.maxChildCount;void 0===i&&(i=50);var a=e.maxChildDiffCount;void 0===a&&(a=3);var l=e.valueDiffing;void 0===l&&(l=!0);var r=e.textDiff;void 0===r&&(r=function(){arguments[0].data=arguments[3]});var c=e.preVirtualDiffApply;void 0===c&&(c=function(){});var u=e.postVirtualDiffApply;void 0===u&&(u=function(){});var h=e.preDiffApply;void 0===h&&(h=function(){});var d=e.postDiffApply;void 0===d&&(d=function(){});var f=e.filterOuterDiff;void 0===f&&(f=null);var p=e.compress;void 0===p&&(p=!1),this.debug=s,this.diffcap=n,this.maxDepth=o,this.maxChildCount=i,this.maxChildDiffCount=a,this.valueDiffing=l,this.textDiff=r,this.preVirtualDiffApply=c,this.postVirtualDiffApply=u,this.preDiffApply=h,this.postDiffApply=d,this.filterOuterDiff=f,this.compress=p;var m=["addAttribute","modifyAttribute","removeAttribute","modifyTextElement","relocateGroup","removeElement","addElement","removeTextElement","addTextElement","replaceElement","modifyValue","modifyChecked","modifySelected","modifyComment","action","route","oldValue","newValue","element","group","from","to","name","value","data","attributes","nodeName","childNodes","checked","selected"];this._const={},this.compress?m.forEach(function(e,s){return t._const[e]=s}):m.forEach(function(e){return t._const[e]=e})};m.prototype.diff=function(e,s){var n=this.nodeToObj(e),o=this.nodeToObj(s);return t=0,this.debug&&(this.t1Orig=this.nodeToObj(e),this.t2Orig=this.nodeToObj(s)),this.tracker=new p,this.findDiffs(n,o)},m.prototype.findDiffs=function(e,n){var o;do{if(this.debug&&(t+=1)>this.diffcap)throw window.diffError=[this.t1Orig,this.t2Orig],new Error("surpassed diffcap:"+JSON.stringify(this.t1Orig)+" -> "+JSON.stringify(this.t2Orig));0===(o=this.findNextDiff(e,n,[])).length&&(r(e,n)||(s?(console.error("Could not find remaining diffs!"),console.log({t1:e,t2:n})):(s=!0,l(e),o=this.findNextDiff(e,n,[])))),o.length>0&&(s=!1,this.tracker.add(o),this.applyVirtual(e,o))}while(o.length>0);return this.tracker.list},m.prototype.findNextDiff=function(e,t,s){var n,o;if(this.maxDepth&&s.length>this.maxDepth)return[];if(!e.outerDone){if(n=this.findOuterDiff(e,t,s),this.filterOuterDiff&&(o=this.filterOuterDiff(e,t,n))&&(n=o),n.length>0)return e.outerDone=!0,n;e.outerDone=!0}if(!e.innerDone){if((n=this.findInnerDiff(e,t,s)).length>0)return n;e.innerDone=!0}if(this.valueDiffing&&!e.valueDone){if((n=this.findValueDiff(e,t,s)).length>0)return e.valueDone=!0,n;e.valueDone=!0}return[]},m.prototype.findOuterDiff=function(e,t,s){var o,i,a,l,c,h,d=[];if(e.nodeName!==t.nodeName)return[(new n).setValue(this._const.action,this._const.replaceElement).setValue(this._const.oldValue,u(e)).setValue(this._const.newValue,u(t)).setValue(this._const.route,s)];if(s.length&&this.maxChildCount&&e.childNodes&&t.childNodes&&e.childNodes.length>this.maxChildCount&&t.childNodes.length>this.maxChildCount){for(var f=e.childNodes.length<t.childNodes.length?e.childNodes.length:t.childNodes.length,p=0,m=0;p<this.maxChildDiffCount&&m<f;)r(e.childNodes[m],t.childNodes[m])||p++,m++;if(p===this.maxChildDiffCount)return[(new n).setValue(this._const.action,this._const.replaceElement).setValue(this._const.oldValue,u(e)).setValue(this._const.newValue,u(t)).setValue(this._const.route,s)]}if(e.data!==t.data)return"#text"===e.nodeName?[(new n).setValue(this._const.action,this._const.modifyTextElement).setValue(this._const.route,s).setValue(this._const.oldValue,e.data).setValue(this._const.newValue,t.data)]:[(new n).setValue(this._const.action,this._const.modifyComment).setValue(this._const.route,s).setValue(this._const.oldValue,e.data).setValue(this._const.newValue,t.data)];for(i=e.attributes?Object.keys(e.attributes).sort():[],a=t.attributes?Object.keys(t.attributes).sort():[],l=i.length,h=0;h<l;h++)o=i[h],-1===(c=a.indexOf(o))?d.push((new n).setValue(this._const.action,this._const.removeAttribute).setValue(this._const.route,s).setValue(this._const.name,o).setValue(this._const.value,e.attributes[o])):(a.splice(c,1),e.attributes[o]!==t.attributes[o]&&d.push((new n).setValue(this._const.action,this._const.modifyAttribute).setValue(this._const.route,s).setValue(this._const.name,o).setValue(this._const.oldValue,e.attributes[o]).setValue(this._const.newValue,t.attributes[o])));for(l=a.length,h=0;h<l;h++)o=a[h],d.push((new n).setValue(this._const.action,this._const.addAttribute).setValue(this._const.route,s).setValue(this._const.name,o).setValue(this._const.value,t.attributes[o]));return d},m.prototype.nodeToObj=function(e){var t,s,n,o,i,a={};if(a.nodeName=e.nodeName,"#text"===a.nodeName||"#comment"===a.nodeName)a.data=e.data;else{if(e.attributes&&e.attributes.length>0)for(a.attributes={},n=(t=Array.prototype.slice.call(e.attributes)).length,i=0;i<n;i++)o=t[i],a.attributes[o.name]=o.value;if("TEXTAREA"===a.nodeName)a.value=e.value;else if(e.childNodes&&e.childNodes.length>0)for(a.childNodes=[],n=(t=Array.prototype.slice.call(e.childNodes)).length,i=0;i<n;i++)s=t[i],a.childNodes.push(this.nodeToObj(s));this.valueDiffing&&(void 0!==e.checked&&e.type&&["radio","checkbox"].includes(e.type.toLowerCase())?a.checked=e.checked:void 0!==e.value&&(a.value=e.value),void 0!==e.selected&&(a.selected=e.selected))}return a},m.prototype.objToNode=function(e,t){var s,n,o,i,a,l,r;if("#text"===e.nodeName)s=document.createTextNode(e.data);else if("#comment"===e.nodeName)s=document.createComment(e.data);else{if("svg"===e.nodeName||t?(s=document.createElementNS("http://www.w3.org/2000/svg",e.nodeName),t=!0):s=document.createElement(e.nodeName),e.attributes)for(l=(o=Object.keys(e.attributes)).length,r=0;r<l;r++)n=o[r],s.setAttribute(n,e.attributes[n]);if(e.childNodes)for(l=(a=e.childNodes).length,r=0;r<l;r++)i=a[r],s.appendChild(this.objToNode(i,t));this.valueDiffing&&(e.value&&(s.value=e.value),e.checked&&(s.checked=e.checked),e.selected&&(s.selected=e.selected))}return s},m.prototype.findInnerDiff=function(e,t,s){var o,i=e.subsets&&e.subsetsAge--?e.subsets:e.childNodes&&t.childNodes?function(e,t){for(var s=e.childNodes?e.childNodes:[],n=t.childNodes?t.childNodes:[],o=d(s.length,!1),i=d(n.length,!1),a=[],l=!0,r=function(){return arguments[1]};l;)(l=h(s,n,o,i))&&(a.push(l),Array.apply(void 0,new Array(l.length)).map(r).forEach(function(e){return t=e,o[l.oldValue+t]=!0,void(i[l.newValue+t]=!0);var t}));return e.subsets=a,e.subsetsAge=100,a}(e,t):[],a=e.childNodes?e.childNodes:[],l=t.childNodes?t.childNodes:[],r=[],c=0;if(i.length>0&&(r=this.attemptGroupRelocation(e,t,i,s)).length>0)return r;var f=Math.max(a.length,l.length);a.length!==l.length&&(o=!0);for(var p=0;p<f;p+=1){var m=a[p],_=l[p];o&&(m&&!_?"#text"===m.nodeName?(r.push((new n).setValue(this._const.action,this._const.removeTextElement).setValue(this._const.route,s.concat(c)).setValue(this._const.value,m.data)),c-=1):(r.push((new n).setValue(this._const.action,this._const.removeElement).setValue(this._const.route,s.concat(c)).setValue(this._const.element,u(m))),c-=1):_&&!m&&("#text"===_.nodeName?r.push((new n).setValue(this._const.action,this._const.addTextElement).setValue(this._const.route,s.concat(c)).setValue(this._const.value,_.data)):r.push((new n).setValue(this._const.action,this._const.addElement).setValue(this._const.route,s.concat(c)).setValue(this._const.element,u(_))))),m&&_&&(r=r.concat(this.findNextDiff(m,_,s.concat(c)))),c+=1}return e.innerDone=!0,r},m.prototype.attemptGroupRelocation=function(e,t,s,o){for(var i,a,l,r,h,f,p=function(e,t,s){var n=e.childNodes?d(e.childNodes.length,!0):[],o=t.childNodes?d(t.childNodes.length,!0):[],i=0;return s.forEach(function(e){for(var t=e.oldValue+e.length,s=e.newValue+e.length,a=e.oldValue;a<t;a+=1)n[a]=i;for(var l=e.newValue;l<s;l+=1)o[l]=i;i+=1}),{gaps1:n,gaps2:o}}(e,t,s),m=p.gaps1,_=p.gaps2,V=Math.min(m.length,_.length),g=[],v=0,b=0;v<V;b+=1,v+=1)if(!0===m[v])if("#text"===(r=e.childNodes[b]).nodeName){if("#text"===t.childNodes[v].nodeName&&r.data!==t.childNodes[v].data){for(f=b;e.childNodes.length>f+1&&"#text"===e.childNodes[f+1].nodeName;)if(f+=1,t.childNodes[v].data===e.childNodes[f].data){h=!0;break}if(!h)return g.push((new n).setValue(this._const.action,this._const.modifyTextElement).setValue(this._const.route,o.concat(v)).setValue(this._const.oldValue,r.data).setValue(this._const.newValue,t.childNodes[v].data)),g}g.push((new n).setValue(this._const.action,this._const.removeTextElement).setValue(this._const.route,o.concat(v)).setValue(this._const.value,r.data)),m.splice(v,1),V=Math.min(m.length,_.length),v-=1}else g.push((new n).setValue(this._const.action,this._const.removeElement).setValue(this._const.route,o.concat(v)).setValue(this._const.element,u(r))),m.splice(v,1),V=Math.min(m.length,_.length),v-=1;else if(!0===_[v])"#text"===(r=t.childNodes[v]).nodeName?(g.push((new n).setValue(this._const.action,this._const.addTextElement).setValue(this._const.route,o.concat(v)).setValue(this._const.value,r.data)),m.splice(v,0,!0),V=Math.min(m.length,_.length),b-=1):(g.push((new n).setValue(this._const.action,this._const.addElement).setValue(this._const.route,o.concat(v)).setValue(this._const.element,u(r))),m.splice(v,0,!0),V=Math.min(m.length,_.length),b-=1);else if(m[v]!==_[v]){if(g.length>0)return g;if(l=s[m[v]],(a=Math.min(l.newValue,e.childNodes.length-l.length))!==l.oldValue){i=!1;for(var N=0;N<l.length;N+=1)c(e.childNodes[a+N],e.childNodes[l.oldValue+N],[],!1,!0)||(i=!0);if(i)return[(new n).setValue(this._const.action,this._const.relocateGroup).setValue("groupLength",l.length).setValue(this._const.from,l.oldValue).setValue(this._const.to,a).setValue(this._const.route,o)]}}return g},m.prototype.findValueDiff=function(e,t,s){var o=[];return e.selected!==t.selected&&o.push((new n).setValue(this._const.action,this._const.modifySelected).setValue(this._const.oldValue,e.selected).setValue(this._const.newValue,t.selected).setValue(this._const.route,s)),(e.value||t.value)&&e.value!==t.value&&"OPTION"!==e.nodeName&&o.push((new n).setValue(this._const.action,this._const.modifyValue).setValue(this._const.oldValue,e.value||"").setValue(this._const.newValue,t.value||"").setValue(this._const.route,s)),e.checked!==t.checked&&o.push((new n).setValue(this._const.action,this._const.modifyChecked).setValue(this._const.oldValue,e.checked).setValue(this._const.newValue,t.checked).setValue(this._const.route,s)),o},m.prototype.applyVirtual=function(e,t){var s=this;return t.forEach(function(t){s.applyVirtualDiff(e,t)}),!0},m.prototype.getFromVirtualRoute=function(e,t){var s,n,o=e;for(t=t.slice();t.length>0;){if(!o.childNodes)return!1;n=t.splice(0,1)[0],s=o,o=o.childNodes[n]}return{node:o,parentNode:s,nodeIndex:n}},m.prototype.applyVirtualDiff=function(e,t){var s,n,o,i=this,a=this.getFromVirtualRoute(e,t[this._const.route]),l=a.node,r=a.parentNode,c=a.nodeIndex,h=[],d={diff:t,node:l};if(this.preVirtualDiffApply(d))return!0;switch(t[this._const.action]){case this._const.addAttribute:l.attributes||(l.attributes={}),l.attributes[t[this._const.name]]=t[this._const.value],"checked"===t[this._const.name]?l.checked=!0:"selected"===t[this._const.name]?l.selected=!0:"INPUT"===l.nodeName&&"value"===t[this._const.name]&&(l.value=t[this._const.value]);break;case this._const.modifyAttribute:l.attributes[t[this._const.name]]=t[this._const.newValue];break;case this._const.removeAttribute:delete l.attributes[t[this._const.name]],0===Object.keys(l.attributes).length&&delete l.attributes,"checked"===t[this._const.name]?l.checked=!1:"selected"===t[this._const.name]?delete l.selected:"INPUT"===l.nodeName&&"value"===t[this._const.name]&&delete l.value;break;case this._const.modifyTextElement:l.data=t[this._const.newValue];break;case this._const.modifyValue:l.value=t[this._const.newValue];break;case this._const.modifyComment:l.data=t[this._const.newValue];break;case this._const.modifyChecked:l.checked=t[this._const.newValue];break;case this._const.modifySelected:l.selected=t[this._const.newValue];break;case this._const.replaceElement:(s=u(t[this._const.newValue])).outerDone=!0,s.innerDone=!0,s.valueDone=!0,r.childNodes[c]=s;break;case this._const.relocateGroup:l.childNodes.splice(t[this._const.from],t.groupLength).reverse().forEach(function(e){return l.childNodes.splice(t[i._const.to],0,e)}),l.subsets&&l.subsets.forEach(function(e){if(t[i._const.from]<t[i._const.to]&&e.oldValue<=t[i._const.to]&&e.oldValue>t[i._const.from]){e.oldValue-=t.groupLength;var s=e.oldValue+e.length-t[i._const.to];s>0&&(h.push({oldValue:t[i._const.to]+t.groupLength,newValue:e.newValue+e.length-s,length:s}),e.length-=s)}else if(t[i._const.from]>t[i._const.to]&&e.oldValue>t[i._const.to]&&e.oldValue<t[i._const.from]){e.oldValue+=t.groupLength;var n=e.oldValue+e.length-t[i._const.to];n>0&&(h.push({oldValue:t[i._const.to]+t.groupLength,newValue:e.newValue+e.length-n,length:n}),e.length-=n)}else e.oldValue===t[i._const.from]&&(e.oldValue=t[i._const.to])});break;case this._const.removeElement:r.childNodes.splice(c,1),r.subsets&&r.subsets.forEach(function(e){e.oldValue>c?e.oldValue-=1:e.oldValue===c?e.delete=!0:e.oldValue<c&&e.oldValue+e.length>c&&(e.oldValue+e.length-1===c?e.length--:(h.push({newValue:e.newValue+c-e.oldValue,oldValue:c,length:e.length-c+e.oldValue-1}),e.length=c-e.oldValue))}),l=r;break;case this._const.addElement:n=t[this._const.route].slice(),o=n.splice(n.length-1,1)[0],l=this.getFromVirtualRoute(e,n).node,(s=u(t[this._const.element])).outerDone=!0,s.innerDone=!0,s.valueDone=!0,l.childNodes||(l.childNodes=[]),o>=l.childNodes.length?l.childNodes.push(s):l.childNodes.splice(o,0,s),l.subsets&&l.subsets.forEach(function(e){if(e.oldValue>=o)e.oldValue+=1;else if(e.oldValue<o&&e.oldValue+e.length>o){var t=e.oldValue+e.length-o;h.push({newValue:e.newValue+e.length-t,oldValue:o+1,length:t}),e.length-=t}});break;case this._const.removeTextElement:r.childNodes.splice(c,1),"TEXTAREA"===r.nodeName&&delete r.value,r.subsets&&r.subsets.forEach(function(e){e.oldValue>c?e.oldValue-=1:e.oldValue===c?e.delete=!0:e.oldValue<c&&e.oldValue+e.length>c&&(e.oldValue+e.length-1===c?e.length--:(h.push({newValue:e.newValue+c-e.oldValue,oldValue:c,length:e.length-c+e.oldValue-1}),e.length=c-e.oldValue))}),l=r;break;case this._const.addTextElement:n=t[this._const.route].slice(),o=n.splice(n.length-1,1)[0],(s={}).nodeName="#text",s.data=t[this._const.value],(l=this.getFromVirtualRoute(e,n).node).childNodes||(l.childNodes=[]),o>=l.childNodes.length?l.childNodes.push(s):l.childNodes.splice(o,0,s),"TEXTAREA"===l.nodeName&&(l.value=t[this._const.newValue]),l.subsets&&l.subsets.forEach(function(e){if(e.oldValue>=o&&(e.oldValue+=1),e.oldValue<o&&e.oldValue+e.length>o){var t=e.oldValue+e.length-o;h.push({newValue:e.newValue+e.length-t,oldValue:o+1,length:t}),e.length-=t}});break;default:console.log("unknown action")}l.subsets&&(l.subsets=l.subsets.filter(function(e){return!e.delete&&e.oldValue!==e.newValue}),h.length&&(l.subsets=l.subsets.concat(h))),d.newNode=s,this.postVirtualDiffApply(d)},m.prototype.apply=function(e,t){var s=this;return t.every(function(t){return s.applyDiff(e,t)})},m.prototype.getFromRoute=function(e,t){for(t=t.slice();t.length>0;){if(!e.childNodes)return!1;var s=t.splice(0,1)[0];e=e.childNodes[s]}return e},m.prototype.applyDiff=function(e,t){var s,n,o,i,a=this,l=this.getFromRoute(e,t[this._const.route]),r={diff:t,node:l};if(this.preDiffApply(r))return!0;switch(t[this._const.action]){case this._const.addAttribute:if(!l||!l.setAttribute)return!1;l.setAttribute(t[this._const.name],t[this._const.value]);break;case this._const.modifyAttribute:if(!l||!l.setAttribute)return!1;l.setAttribute(t[this._const.name],t[this._const.newValue]),"INPUT"===l.nodeName&&"value"===t[this._const.name]&&(l.value=t[this._const.oldValue]);break;case this._const.removeAttribute:if(!l||!l.removeAttribute)return!1;l.removeAttribute(t[this._const.name]);break;case this._const.modifyTextElement:if(!l||3!==l.nodeType)return!1;this.textDiff(l,l.data,t[this._const.oldValue],t[this._const.newValue]);break;case this._const.modifyValue:if(!l||void 0===l.value)return!1;l.value=t[this._const.newValue];break;case this._const.modifyComment:if(!l||void 0===l.data)return!1;this.textDiff(l,l.data,t[this._const.oldValue],t[this._const.newValue]);break;case this._const.modifyChecked:if(!l||void 0===l.checked)return!1;l.checked=t[this._const.newValue];break;case this._const.modifySelected:if(!l||void 0===l.selected)return!1;l.selected=t[this._const.newValue];break;case this._const.replaceElement:l.parentNode.replaceChild(this.objToNode(t[this._const.newValue],"http://www.w3.org/2000/svg"===l.namespaceURI),l);break;case this._const.relocateGroup:Array.apply(void 0,new Array(t.groupLength)).map(function(){return l.removeChild(l.childNodes[t[a._const.from]])}).forEach(function(e,s){0===s&&(n=l.childNodes[t[a._const.to]]),l.insertBefore(e,n||null)});break;case this._const.removeElement:l.parentNode.removeChild(l);break;case this._const.addElement:i=(o=t[this._const.route].slice()).splice(o.length-1,1)[0],(l=this.getFromRoute(e,o)).insertBefore(this.objToNode(t[this._const.element],"http://www.w3.org/2000/svg"===l.namespaceURI),l.childNodes[i]||null);break;case this._const.removeTextElement:if(!l||3!==l.nodeType)return!1;l.parentNode.removeChild(l);break;case this._const.addTextElement:if(i=(o=t[this._const.route].slice()).splice(o.length-1,1)[0],s=document.createTextNode(t[this._const.value]),!(l=this.getFromRoute(e,o))||!l.childNodes)return!1;l.insertBefore(s,l.childNodes[i]||null);break;default:console.log("unknown action")}return r.newNode=s,this.postDiffApply(r),!0},m.prototype.undo=function(e,t){var s=this;t.length||(t=[t]),(t=t.slice()).reverse(),t.forEach(function(t){s.undoDiff(e,t)})},m.prototype.undoDiff=function(e,t){switch(t[this._const.action]){case this._const.addAttribute:t[this._const.action]=this._const.removeAttribute,this.applyDiff(e,t);break;case this._const.modifyAttribute:f(t,this._const.oldValue,this._const.newValue),this.applyDiff(e,t);break;case this._const.removeAttribute:t[this._const.action]=this._const.addAttribute,this.applyDiff(e,t);break;case this._const.modifyTextElement:case this._const.modifyValue:case this._const.modifyComment:case this._const.modifyChecked:case this._const.modifySelected:case this._const.replaceElement:f(t,this._const.oldValue,this._const.newValue),this.applyDiff(e,t);break;case this._const.relocateGroup:f(t,this._const.from,this._const.to),this.applyDiff(e,t);break;case this._const.removeElement:t[this._const.action]=this._const.addElement,this.applyDiff(e,t);break;case this._const.addElement:t[this._const.action]=this._const.removeElement,this.applyDiff(e,t);break;case this._const.removeTextElement:t[this._const.action]=this._const.addTextElement,this.applyDiff(e,t);break;case this._const.addTextElement:t[this._const.action]=this._const.removeTextElement,this.applyDiff(e,t);break;default:console.log("unknown action")}};var _=function(e){var t=this;void 0===e&&(e={}),this.pad="│   ",this.padding="",this.tick=1,this.messages=[];var s=function(e,s){var n=e[s];e[s]=function(){for(var o=[],i=arguments.length;i--;)o[i]=arguments[i];t.fin(s,Array.prototype.slice.call(o));var a=n.apply(e,o);return t.fout(s,a),a}};for(var n in e)"function"==typeof e[n]&&s(e,n);this.log("┌ TRACELOG START")};return _.prototype.fin=function(e,t){this.padding+=this.pad,this.log("├─> entering "+e,t)},_.prototype.fout=function(e,t){this.log("│<──┘ generated return value",t),this.padding=this.padding.substring(0,this.padding.length-this.pad.length)},_.prototype.format=function(e,t){return function(e){for(e=""+e;e.length<4;)e="0"+e;return e}(t)+"> "+this.padding+e},_.prototype.log=function(){var e=Array.prototype.slice.call(arguments),t=function(e){return e?"string"==typeof e?e:e instanceof HTMLElement?e.outerHTML||"<empty>":e instanceof Array?"["+e.map(t).join(",")+"]":e.toString()||e.valueOf()||"<unknown>":"<falsey>"};e=e.map(t).join(", "),this.messages.push(this.format(e,this.tick++))},_.prototype.toString=function(){for(var e="└───";e.length<=this.padding.length+this.pad.length;)e+="×   ";var t=this.padding;return this.padding="",e=this.format(e,this.tick),this.padding=t,this.messages.join("\n")+"\n"+e},e.DiffDOM=m,e.TraceLogger=_,e}({});
